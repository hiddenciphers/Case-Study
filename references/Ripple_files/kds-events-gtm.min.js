kds.version="1.9.8";(function(o,d,e,t){var i,l,n,a,s,r,c;var p=";";function m(e,t){if(c&&c.DEBUG===true){console.log(e,t)}}function f(e){var r=Math.round(Date.now()/1e3);var t="krg_tc_d";var i=5;var n=30*60;var a=function(){var e=localStorage.getItem(t);try{if(e){return JSON.parse(e)}}catch(e){localStorage.removeItem(t)}return null};var s=function(e){localStorage.setItem(t,JSON.stringify(e))};var c=function(e){e.hasFired=true;s(e);kds("track","TrueClick",{id:e.krgBid})};var o=function(e){var t={timestamp:r,krgBid:e,hasFired:false};s(t);return t};var d=function(e,t){setTimeout(function(){c(e)},t*1e3)};var l=new URLSearchParams(e.location.search);var p=l.get(KRG_IMP_ID)||"";var m=a();if(m&&(p&&m.krgBid==p||!p)){if(m.hasFired)return;if(r-m.timestamp>n)return;d(m,Math.max(0,i-(r-m.timestamp)));return}if(p){d(o(p),i);return}}function u(){o.KARGO=o.KARGO||{};o.KARGO.kds=o.KARGO.kds||{};c=o.KARGO.kds;m("Initializing KDS Events.");l=c.PIXEL_COOKIE||"krg_pixel";n=c.KTC_ID||"ktcid";a=c.KTCT_ID||"ktctid";EVENTS_URL=c.EVENTS_URL||"//kds-pixel.kargo.com";KRG_IMP_ID=c.KRG_IMP_ID||"krg_imp_id";if(EVENTS_URL&&EVENTS_URL.length>0){i=e.protocol+EVENTS_URL+"/api/v1"}N(o.kds.queue);o.kds.callMethod=b;o.kds.relayCallMethod=T}function k(e){kimp=v();o.KARGO.kds.partnerId=e;o.KARGO.kds.viewId=C();var t=g(l);if(!t){t=C();K(l,t,I())}s=c.CERB_SYNC_ENABLED!="false"&&!h();if(s){var r=d.createElement("iframe");r.style.cssText="display:none;";cerbUrl=c.TAPAD_CERB_URL||"https://crb.kargo.com";r.src=cerbUrl+"/api/v1/initsync/"+g(l)+"?partners=Tapad";d.body.appendChild(r);K("cerb_tapad","1",I())}var i={partner_id:e,client_id:t,ktc_id:O(n),ktct_id:O(a),kimp:kimp,event:"init",client_referer:d.referrer,params:{view_id:o.KARGO.kds.viewId}};w(i);f(o);if(kimp){A()}}function v(){try{lsKimp=o.localStorage.getItem("kimp");pkimp=new URL(o.top.location.href).searchParams.get(KRG_IMP_ID);vlsKimp=_(lsKimp);vpkimp=_(pkimp);if(!vlsKimp&&!vpkimp){return""}if(vlsKimp&&!vpkimp){return lsKimp}if(!vlsKimp&&vpkimp){try{o.localStorage.setItem("kimp",pkimp)}catch(e){L(e,pkimp)}return pkimp}if(vlsKimp&&vpkimp){if(lsKimp===pkimp){return lsKimp}else{try{o.localStorage.setItem("kimp",pkimp)}catch(e){L(e,pkimp)}return pkimp}}return""}catch(e){return""}}function g(e){var t=O(e);if(t&&t.trim()!=""){return t}var r=o.localStorage.getItem(e);if(r&&r.trim()!=""){return r}return t}function _(e){return e&&e.length<=38&&e.length>=36}function h(){return O("cerb_tapad")==="1"||o.localStorage.getItem("cerb_tapad")==="1"}function K(t,r,i){if(!o.navigator.cookieEnabled||o.localStorage){try{o.localStorage.setItem(t,r)}catch(e){R(t,r,i)}}else{R(t,r,i)}}function R(e,t,r){var i=e+"="+t+p+"domain="+r+p+"path=/"+p+"max-age=31536000"+p+"SameSite=Lax";d.cookie=i;return i}function O(e){var t=e+"=";var r=d.cookie.split(";");for(var i=0;i<r.length;i++){var n=r[i];while(n.charAt(0)==" ")n=n.substring(1,n.length);if(n.indexOf(t)==0)return n.substring(t.length,n.length)}return undefined}function I(){var e=d.domain;try{return e.substring(e.indexOf("."),e.length)}catch(e){return d.domain}}function A(){if(!o.KARGO.kds.viewtime){o.KARGO.kds.viewtime=o.KARGO.kds.viewtime||1;o.KARGO.kds.timer=o.setInterval(G,1e3*5);return}}function G(){o.KARGO.kds.viewtime=o.KARGO.kds.viewtime||1;var e={partner_id:o.KARGO.kds.partnerId,client_id:g(l),event:"T"+o.KARGO.kds.viewtime*5,kimp:kimp=v(),client_referer:d.referrer,params:{view_id:o.KARGO.kds.viewId}};w(e);if(o.KARGO.kds.viewtime&&o.KARGO.kds.viewtime>=2){o.clearInterval(o.KARGO.kds.timer)}o.KARGO.kds.viewtime=o.KARGO.kds.viewtime+1}function w(e){if(!i){m("Mising EVENTS_URL, request will not be sent.");return}var t=false;try{e["page_url"]=o.location.href}catch(e){}if(o.navigator.sendBeacon){e.meta="b";t=o.navigator.sendBeacon(i,JSON.stringify(e))}if(!o.navigator.sendBeacon||!t){e.meta="x";var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===4){if(r.status!=200&&r.status!="OK"){e.meta="x - i;"+r.status;S(e)}}};r.open("POST",i,true);r.withCredentials=true;r.send(JSON.stringify(e))}}function S(e){o.KARGO.kds.viewId=o.KARGO.kds.viewId||C();var t=d.createElement("img");t.style.cssText="display:none;";t.src=i+"/track?"+y(e);d.body.appendChild(t)}function y(e){return E("",e)+"&cid="+Math.random()}function E(r,i){Object.keys(i).forEach(function(e){if(e!="client_referer"){if(i[e]){var t=i[e];if(t.toString()==="[object Object]"){r=E(r,t)}else{r=r+e+"="+t+"&"}}}});return r}function b(e){try{var t=Array.prototype.slice.call(arguments);e=t.shift();switch(e){case"init":k.apply(this,t);break;case"track":M(this,e,t);break}}catch(e){L(e,v())}}function T(e){kds.callMethod.apply(this,e)}function L(e,t){w({partner_id:o.KARGO.kds.partnerId,client_id:g(l),ktc_id:O(n),ktct_id:O(a),kimp:t,event:"Error",params:{name:e.name,message:e.message,view_id:o.KARGO.kds.viewId},client_referer:d.referrer})}function M(e,t,r){var i=r[0];var n=r.length===1?{}:r[1];var a=Object.assign({},n);var s=g(l);if(!s){s=C();K(l,s,I())}n.view_id=o.KARGO.kds.viewId;var c={partner_id:o.KARGO.kds.partnerId,client_id:s,event:i,kimp:v(),params:n,client_referer:d.referrer};w(c);if(o.krg_pgs&&i!="TrueClick"){o.krg_pgs(t,i,a)}}function C(){return D()+D()+"-"+D()+"-"+D()+"-"+D()+"-"+D()+D()+D()}function D(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function N(e){while(e.length){var t=e.shift();b.apply(o.kds,t)}}if(d.readyState!=="loading"){u()}else{d.addEventListener("DOMContentLoaded",u)}})(window,document,location);