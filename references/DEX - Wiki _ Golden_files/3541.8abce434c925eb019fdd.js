"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[3541],{57687:(e,t,l)=>{l.d(t,{Z:()=>a});var o=l(27378),n=l(55480),i=l(44926),s=l(28206),r=l(24246);const d={border:"1px solid",borderColor:"border1",bg:"bg1",":not(:last-child)":{borderBottom:"none"},":first-of-type":{borderTopLeftRadius:"md",borderTopRightRadius:"md"},":last-child":{borderBottomLeftRadius:"md",borderBottomRightRadius:"md"}},a=({label:e,children:t,fieldName:l,collapsible:a=!1,extra:u,sx:c={},itemSx:p={}})=>{const[x,f]=(0,o.useState)(!1),v=(0,s.C)((e=>{var t;return(null===(t=e.infoboxFieldTypes.data)||void 0===t?void 0:t.field_types)||[]})),m=(0,o.useMemo)((()=>v.find((e=>e.name===l))),[v,l]),y=a&&o.Children.count(t)>10;return(0,r.jsxs)(n.kC,{sx:{pl:[0,3],alignItems:"baseline",flexDirection:["column","row"],...c},children:[(0,r.jsxs)(n.xv,{variant:"heading4",sx:{flexBasis:[24,240],display:"flex",alignItems:"center","> *":{verticalAlign:"middle"}},children:[e,(0,r.jsx)(i.Z,{sx:{ml:0},fieldType:m})]}),(0,r.jsxs)(n.xu,{sx:{flex:1,minWidth:240,maxWidth:560,width:"100%"},children:[o.Children.map(t,((e,t)=>!e||a&&!x&&t>=10?null:(0,r.jsx)(n.xu,{sx:{...d,...p},children:e}))),y?(0,r.jsx)(n.xu,{onClick:()=>f(!x),sx:{...d,px:3,py:2,cursor:"pointer",":hover":{bg:"bg2"}},children:x?(0,r.jsx)(n.xv,{variant:"caption1",children:"show less"}):"•••"}):null,u]})]})}},23543:(e,t,l)=>{l.d(t,{Z:()=>S,s:()=>F});var o=l(43605),n=l.n(o),i=l(27378),s=l(55480),r=l(21020),d=l(69554),a=l(88594),u=l(84891),c=l(262),p=l(46345),x=l(28206),f=l(69809),v=l(77038),m=l(89856),y=l(11701),h=l(96256);l(73902);var b=l(57687),_=l(92598),j=l(42422),C=l(97894),g=l(87389),I=l(48243);var T=l(24246);const Z=(e,t)=>{if(null==t||null==e)return e;switch(t){case"float":return parseFloat(e);case"int":return parseInt(e);case"date":{const t=new Date(e);return{day:t.getUTCDate(),year:t.getUTCFullYear(),month:t.getUTCMonth()+1}}case"entity":if("object"==typeof e&&null!=e.goldenId)return parseInt(e.goldenId)}return e},F=(0,m.Z)((e=>{var t,l,o,i,s,r,d,a,u,c,p,x,f,m;const y=(0,v.ew)(e),h=(null!==(t=null===(l=e.entity)||void 0===l||null===(o=l.entity)||void 0===o||null===(i=o.protocol_triples)||void 0===i||null===(s=i.data)||void 0===s||null===(r=s.entityByGoldenId)||void 0===r||null===(d=r.statementsByObjectEntityId)||void 0===d?void 0:d.nodes)&&void 0!==t?t:[]).map((e=>({...e,objectEntity:e.subject,predicateId:e.predicate.inverseId}))),b=null!==(a=null===(u=e.entity)||void 0===u||null===(c=u.entity)||void 0===c||null===(p=c.protocol_triples)||void 0===p||null===(x=p.data)||void 0===x||null===(f=x.entityByGoldenId)||void 0===f||null===(m=f.statementsBySubjectId)||void 0===m?void 0:m.nodes)&&void 0!==a?a:[];return n()(b.concat(h).map((e=>{var t;const l=y.find((t=>t.protocol_predicate===e.predicateId));return{label:null==l?void 0:l.default_label,name:null==l?void 0:l.name,field_model:null==l?void 0:l.field_model,display_value:Z(null!==(t=e.objectValue)&&void 0!==t?t:e.objectEntity,null==l?void 0:l.field_model),protocol_triple_id:e.id,protocol_predicate:null==l?void 0:l.protocol_predicate,validation_status:e.validationStatus,sources:e.citationsByTripleId.nodes.map((e=>e.id)),isProtocol:!0}})),["validation_status"])}),(e=>{var t,l,o;return{protocolTriples:null===(t=e.entity)||void 0===t||null===(l=t.entity)||void 0===l?void 0:l.protocol_triples,fieldTypes:null===(o=e.infoboxFieldTypes.data)||void 0===o?void 0:o.field_types}})),k=(0,m.Z)((e=>{var t,l;return((null===(t=e.entity)||void 0===t||null===(l=t.entity)||void 0===l?void 0:l.infobox)||[]).filter((t=>(0,g.Z)(t)&&!(0,I.Z)(t,e)))}),(e=>{var t,l;return{fields:null===(t=e.entity)||void 0===t||null===(l=t.entity)||void 0===l?void 0:l.infobox,entitiesById:e.data.entitiesById}})),R=({field:e,entity:t})=>{const l=(0,x.T)(),{setInitialSearch:o,setAutofocusField:n}=(0,i.useContext)(c.StructuredDataContext),r=(0,d.Z)(p.Xk.ENTITY,t,{infoboxes:[e]}),{open:a}=(0,h.e)(),{name:u,default_label:v}=e,m=(0,i.useCallback)((e=>{a(e)}),[a]),_=(0,y.Z)({name:"TopicResearchRequestButton",callback:m,state:r}),j=(()=>{const e=(0,x.C)((e=>{var t,l,o;return null!==(t=null==e||null===(l=e.entity)||void 0===l||null===(o=l.entityUserInfo)||void 0===o?void 0:o.research_requests)&&void 0!==t?t:[]})),t=(0,x.C)((e=>{var t,l;return null!==(t=null===(l=e.infoboxFieldTypes.data)||void 0===l?void 0:l.field_types)&&void 0!==t?t:[]}));return(0,i.useMemo)((()=>e.filter((({status:e})=>"approved"!==e&&"canceled"!==e)).reduce(((e,l)=>(l.studies.forEach((l=>{l.details.forEach((l=>{if(l.startsWith("field_type")){const[o,n]=l.split(":"),i=t.find((e=>e.id===parseInt(n)));null!=i&&e.push(i.name)}}))})),e)),[])),[e,t])})().some((t=>t===e.name));return(0,T.jsx)(b.Z,{label:v,fieldName:u,sx:{mb:3},collapsible:!0,children:(0,T.jsxs)("div",{className:"flex items-center rounded-xl border-gray-300 cursor-pointer",children:[(0,T.jsx)("div",{className:"p-6 border-gray-300 hover:bg-gray-100 flex-1  rounded-l-xl",onClick:()=>{o(e.default_label),n(e.name),l((0,f.ns)({selectEditMode:!1}))},children:(0,T.jsx)(s.xv,{variant:"body3",children:"-"})}),(0,T.jsx)("div",{className:"p-6 ml-auto border-l cursor-pointer",onClick:e=>{e.stopPropagation(),j||a(r,{onFollow:_})},children:(0,T.jsx)(s.xv,{variant:"body2",children:j?(0,T.jsx)(s.xu,{sx:{color:"textGold"},children:"Data Requested"}):(0,T.jsx)(s.xu,{variant:"blueLink",children:"Request Data"})})})]})})},E=()=>{const e=(0,x.C)((e=>e.entity.entity)),{open:t}=(0,h.e)(),l=(0,i.useCallback)((e=>t(e)),[t]),o=(({infobox:e})=>{const t=(0,x.C)((e=>e.infoboxFieldTypes.data));return(0,i.useMemo)((()=>{var l;const o=e.filter((e=>(0,g.Z)(e)));return(null!==(l=null==t?void 0:t.field_types)&&void 0!==l?l:[]).filter((e=>"instance_of"!==e.name&&o.some((t=>t.name===e.name))))}),[t,e])})({infobox:(0,x.C)(k)}),n=(0,d.Z)(p.Xk.ENTITY,e,{infoboxes:o}),a=(0,y.Z)({name:"TopicDataRequestUpdate",callback:l,state:n}),c=(0,i.useCallback)((()=>{t(n,{onFollow:a})}),[t,n,a]);return(0,T.jsx)(s.kC,{sx:{py:3,px:[3,4],bg:"bg2",alignItems:"center",borderBottom:"1px solid",borderColor:"border1"},children:(0,T.jsx)(u.R,{tooltip:"If you believe the data to be either incomplete, wrong, or out of date, please request an update.",children:(0,T.jsx)(r.ZP,{size:"lg",onClick:c,disabled:0===o.length,children:"Request data update"})})})},S=()=>{const e=(0,x.T)(),t=(0,x.C)((e=>e.entity.entity));(0,i.useEffect)((()=>window.scrollTo(0,0)),[]),(0,i.useEffect)((()=>{e((0,f.kW)())}),[e]);const l=(0,x.C)(k),o=(0,a.Z)({infobox:l,emptyResponse:[],showReadOnlyFields:!1}).filter((e=>!l.some((t=>t.name===e.name)))),n=(0,x.C)(F),r=(0,i.useMemo)((()=>(0,C.Ok)(n.concat(l))),[l,n]);return 0===r.length?(0,T.jsx)(E,{}):(0,T.jsxs)(s.xu,{sx:{bg:"bg2"},children:[(0,T.jsx)(E,{}),(0,T.jsx)(s.xu,{sx:{px:3,py:4,columnCount:[1,1,1,2],columnGap:4},children:r.map(((e,t)=>{if(!e.length)return null;const{name:l,default_label:o,label:n}=e[0],i=(0,C.Xh)(e[0]);return(0,T.jsx)(s.xu,{sx:{pb:3},children:(0,T.jsx)(b.Z,{label:n||o,fieldName:l,sx:{breakInside:"avoid"},itemSx:{overflow:"hidden"},collapsible:!0,children:e.map(((e,t)=>(0,T.jsxs)(s.xu,{sx:{p:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.isProtocol?(0,T.jsx)(j.Z,{field:e}):(0,T.jsx)(i,{field:e,target:"_blank",tryToFetchEntity:!0}),(0,T.jsx)(_.Z,{field:e})]},t)))})},t)}))}),o.length>0?(0,T.jsx)(s.xu,{sx:{px:3,py:4,columnCount:[1,1,1,2],columnGap:4,borderTop:1,borderColor:"border1"},children:o.map((e=>(0,T.jsx)(R,{field:e,entity:t},e.name)))}):null]})}},48243:(e,t,l)=>{l.d(t,{Z:()=>o});const o=({field_model:e,display_value:t},l)=>{if("entity"!==e&&"location"!==e||!t)return!1;const o=l.data.entitiesById[t];return!o||!o.slug}},88594:(e,t,l)=>{l.d(t,{Z:()=>s}),l(73902),l(95623);var o=l(27378),n=l(24158),i=l(28206);const s=({infobox:e,forcedFields:t=n.LZ,emptyResponse:l,showReadOnlyFields:s=!0})=>{const r=(0,i.C)((e=>e.infoboxFieldTypes.data)),d=(e||[]).reduce(((e,t)=>("instance_of"===t.name&&e.push(t.display_value),e)),[]);return(0,o.useMemo)((()=>{if(0===d.length)return l||r.field_types;const e=r.templates.filter((e=>d.includes(e.entity)));if(0===e.length)return r.field_types;const o={};return t.forEach((e=>o[e.id]=!0)),r.template_field_types.reduce(((t,l)=>{if(e.some((e=>e.id===l.template))){const e=r.field_types.find((e=>e.id===l.field_type)),n=s||!e.is_read_only;!o[e.id]&&n&&(o[e.id]=!0,t.push(e))}return t}),[...t])}),[s,l,t,r.field_types,r.template_field_types,r.templates,d])}},262:(e,t,l)=>{l.r(t),l.d(t,{StructuredDataContext:()=>u,default:()=>c});var o=l(11628),n=l(98784),i=l(27378),s=l(23543),r=l(28206),d=l(24246);const a=(0,o.ZP)({resolved:{},chunkName:()=>"components-Infobox-InfoboxEditor",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!l.m[t]},importAsync:()=>Promise.all([l.e(7882),l.e(2598)]).then(l.bind(l,27864)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then((e=>(this.resolved[t]=!0,e)))},requireSync(e){const t=this.resolve(e);return l(t)},resolve:()=>27864},{ssr:!1}),u=(0,i.createContext)({initialSearch:"",setInitialSearch:n.noop,autoFocusField:null,setAutofocusField:n.noop}),c=()=>{const e=(0,r.C)((e=>e.editor.editMode)),[t,l]=(0,i.useState)(""),[o,n]=(0,i.useState)(null),c=(0,i.useMemo)((()=>({initialSearch:t,setInitialSearch:l,autoFocusField:o,setAutofocusField:n})),[t,o]);return(0,d.jsx)(u.Provider,{value:c,children:e?(0,d.jsx)(a,{}):(0,d.jsx)(s.Z,{})})}}}]);